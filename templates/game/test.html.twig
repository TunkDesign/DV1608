{% extends "game/base.html.twig" %}

{% block title %}Play{% endblock %}

{% block body %}
<div class="game-wrapper">
    {% if not ended %}
        <div class="actions">
            <div>
                <div class="card-stack">
                    <a href="/game/draw"><span class="card" id="draw-button">ðŸ‚ </span></a>
                </div>
                <p>Click on the card to draw.</p>
            </div>

            {% if player.getName != 'Bank' %}

            <a href="/game/hold">
                <button type="submit">Hold</button>
            </a>
            {% endif %}
        </div>
    {% else %}
        <div class="result">
            <p>Winner: {{ winner.getName }}</p>
            <p>Points: {{ winner.getScore }}</p>
        </div>
    {% endif %}
</div>

<hr>

<h1>Players</h1>
<div class="players-row">
    {% for player in players %}
    <div class="player-card" data-name="{{ player.getName }}" data-score="{{ player.getScore }}" {% if player.isActive %}data-active="true"{% endif %}>
        {% if player.isActive %}
            <h3>Playing</h3>
        {% endif %}
        <h4>{{ player.getName }}</h4>
        <p>Points: {{ player.getScore }}</p>
        {% if player.hasFolded %}
            <p>Folded</p>
        {% endif %}

        <div class="card-row">
            {% for card in player.getHand.getCards %}
                <div class="card {{ card.color }}">{{ card.getAsString }}</div>
            {% endfor %}
        </div>
    </div>
{% endfor %}
</div>

<hr>
<a href="/game/reset">
    <button>Reset Gameboard</button>
</a>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const players = document.querySelectorAll('.player-card');
    
        players.forEach(player => {
            const name = player.dataset.name;
            const score = parseInt(player.dataset.score, 10);
            const isActive = player.dataset.active === "true";
    
            if (name === "Bank" && isActive) {
                // Starta automatiskt kortdragning med intervall
                let currentScore = score;
                const interval = setInterval(() => {
                    if (currentScore >= 17) {
                        clearInterval(interval);
                        window.location.href = "/game/hold";
                    } else {
                        // HÃ¤mta nytt kort (simulerar klick pÃ¥ /game/draw)
                        fetch("/game/draw")
                            .then(() => {
                                // Ladda om sidan efter varje dragning
                                window.location.reload();
                            });
                    }
                }, 1000); // Dra nytt kort varje sekund
            }
        });
    });
    </script>
    

{% endblock %}